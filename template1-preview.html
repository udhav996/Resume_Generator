<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Template 1 Preview</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    .resume-container {
      max-width: 750px;
      width: 100%;
      margin: 0 auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      overflow: hidden;
      position: relative;
      /* ensure content can't push the container wider */
      word-break: break-word;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .header {
      background: linear-gradient(135deg, #f989ba, #8cabe8);
      color: white;
      padding: 40px;
      text-align: center;
      position: relative;
    }

    .header img {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      border: 4px solid #fff;
      object-fit: cover;
      position: absolute;
      bottom: -65px;
      left: 50%;
      transform: translateX(-50%);
      background: #eee;
    }

    .header-info {
      margin-top: 80px;
    }
    .header-info h1 {
      margin: 0;
      font-size: 26px;
      font-weight: 700;
    }

    .header-info p {
      margin: 6px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px; /* wider gap between icon and text */
      justify-content: center;
    }

    .content {
      padding: 30px 40px 40px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      /* children allowed to shrink so long text wraps instead of expanding container */
    }
    /* make sure columns can shrink inside the grid */
    .content > div { min-width: 0; }

    /* left column styles */
    .section h2 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #f989ba;
      border-bottom: 2px solid #eee;
      padding-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .about-text {
      font-size: 14px;
      /* preserve new lines */
      white-space: pre-line;
      color: #444;
      line-height: 1.6;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    /* contact items */
    .contact-item {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 12px; /* increased spacing between icon and text */
      margin-bottom: 8px;
      font-size: 14px;
      color: #333;
      overflow-wrap: anywhere;
      word-break: break-word;
    }
    .contact-item i {
      min-width: 18px;
      text-align: center;
      color: #d4a574;
      flex: 0 0 auto;
    }
    .contact-item span {
      display: inline-block;
      min-width: 0;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    /* styled lists */
    ul.styled-list {
      list-style: none;
      padding-left: 0;
    }
    ul.styled-list li {
      font-size: 14px;
      color: #333;
      margin-bottom: 8px;
      position: relative;
      padding-left: 18px;
      overflow-wrap: anywhere;
      word-break: break-word;
    }
    ul.styled-list li::before {
      content: "•";
      position: absolute;
      left: 0;
      color: #d4a574;
      font-weight: bold;
      top: 0;
    }

    /* pair layout: key (bold) + separator + value (wraps) */
    .pair-key {
      font-weight: 600;
      margin-right: 6px;
      white-space: nowrap; /* keep key on same line with separator */
    }
    .pair-sep {
      margin-right: 6px;
      color: #777;
      flex: 0 0 auto;
    }
    .pair-val {
      display: inline-block;
      min-width: 0;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    /* responsive */
    @media (max-width: 720px) {
      .content { grid-template-columns: 1fr; padding: 80px 18px 30px; gap: 20px; }
      .header img { left: 20px; transform: none; bottom: -50px; }
      .header-info { margin-top: 0; padding-left: 150px; } /* avoid overlap with image on small screens */
      .header { height: auto; padding-bottom: 80px; }
    }
  </style>
</head>
<body>

<button onclick="downloadPDF()" 
        style="margin:20px auto;display:block;
               padding:10px 20px;background:#d4a574;
               color:#fff;border:none;border-radius:8px;
               cursor:pointer;font-size:14px;">
  Download PDF
</button>

<div class="resume-container">
  <div class="header"></div>

  <div class="profile-section" style="position: relative;">
    <img id="profilePhoto" class="profile-photo" alt="Profile Photo" style="width:130px;height:130px;border-radius:50%;border:4px solid #fff;object-fit:cover;position:absolute;bottom:-65px;left:50%;transform:translateX(-50%);background:#eee;">
    <div class="header-info" style="text-align:center;margin-top:60px;">
      <h1 id="displayName">YOUR NAME</h1>
      <div style="height:8px;"></div>
      <div class="title" id="displayTitle" style="font-size:14px;color:#666;letter-spacing:1px;"></div>
    </div>
  </div>

  <div class="content">
    <!-- LEFT COLUMN -->
    <div>
      <div class="section" id="contactSection">
        <h2><i class="fas fa-address-book"></i> Contact</h2>
        <div class="contact-item" id="phoneDisplay"><i class="fas fa-phone"></i><span></span></div>
        <div class="contact-item" id="emailDisplay"><i class="fas fa-envelope"></i><span></span></div>
        <div class="contact-item" id="websiteDisplay" style="display:none;"><i class="fas fa-globe"></i><span></span></div>
        <div class="contact-item" id="linkedinDisplay" style="display:none;"><i class="fab fa-linkedin" style="color:#0a66c2;"></i><span></span></div>
        <div class="contact-item" id="githubDisplay" style="display:none;"><i class="fab fa-github"></i><span></span></div>
      </div>

      <div class="section" id="aboutSection">
        <h2><i class="fas fa-user"></i> About Me</h2>
        <div class="about-text" id="summaryDisplay">Add your professional summary here.</div>
      </div>

      <div class="section" id="educationSection">
        <h2><i class="fas fa-graduation-cap"></i> Education</h2>
        <ul class="styled-list" id="educationDisplay"></ul>
      </div>

      <div class="section" id="skillsSection">
        <h2><i class="fas fa-tools"></i> Expertise</h2>
        <ul class="styled-list" id="skillsDisplay"></ul>
      </div>

      <div class="section" id="languagesSection">
        <h2><i class="fas fa-language"></i> Languages</h2>
        <ul class="styled-list" id="languagesDisplay"></ul>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div>
      <div class="section" id="projectsSection">
        <h2><i class="fas fa-code"></i> Projects</h2>
        <ul class="styled-list" id="projectsDisplay"></ul>
      </div>

      <div class="section" id="certificationsSection">
        <h2><i class="fas fa-certificate"></i> Certifications</h2>
        <ul class="styled-list" id="certificationsDisplay"></ul>
      </div>

      <div class="section" id="achievementsSection">
        <h2><i class="fas fa-trophy"></i> Achievements</h2>
        <ul class="styled-list" id="achievementsDisplay"></ul>
      </div>

      <div class="section" id="interestsSection">
        <h2><i class="fas fa-heart"></i> Interests</h2>
        <ul class="styled-list" id="interestsDisplay"></ul>
      </div>
    </div>
  </div>
</div>

<script>
function populateResume() {
  const params = new URLSearchParams(window.location.search);

  // first: handle photoKey (localStorage) fallback
  let photo = params.get('photo') || "";
  const photoKey = params.get('photoKey');
  if (photoKey) {
    try {
      const data = localStorage.getItem(photoKey);
      if (data) {
        photo = data;
        // remove to clean up
        try { localStorage.removeItem(photoKey); } catch(e){/* ignore */ }
      }
    } catch(e) {
      console.warn("Couldn't read photo from localStorage:", e);
    }
  }

  // helper: convert text with newlines into bullet list (split only on newline)
  const makeList = (text) => {
    if (!text) return "";
    // split only on newline characters - user wanted new-lines to create list, NOT commas
    return text.split(/\n+/).map(item => item.trim()).filter(Boolean).map(item => `<li>${item}</li>`).join('');
  };

  // helper: for pairs (first part bold) - lines splitted by newline, each line "Key - Value"
  const makePairs = (text) => {
    if (!text) return "";
    return text.split(/\n+/).map(line => line.trim()).filter(Boolean).map(line => {
      const parts = line.split("-");
      if (parts.length > 1 && parts[0].trim() !== "") {
        // use pair-key, pair-sep, pair-val markup so values wrap nicely
        const key = parts[0].trim();
        const val = parts.slice(1).join("-").trim();
        return `<li><span class="pair-key">${escapeHtml(key)}</span><span class="pair-sep">–</span><span class="pair-val">${escapeHtml(val)}</span></li>`;
      } else {
        return `<li>${escapeHtml(line)}</li>`;
      }
    }).join('');
  };

  // small HTML-escape helper for safety
  function escapeHtml(s){
    if (!s && s !== "") return "";
    return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
  }

  // Photo
  if (photo) document.getElementById('profilePhoto').src = photo;

  // Name & Title
  if (params.get('fullName')) document.getElementById('displayName').textContent = params.get('fullName').toUpperCase();
  if (params.get('jobRole')) document.getElementById('displayTitle').textContent = params.get('jobRole');

  // Contact setter
  const setContact = (id, val) => {
    if (val) {
      const el = document.getElementById(id);
      el.querySelector("span").textContent = val;
      el.style.display = "flex";
    } else {
      const el = document.getElementById(id);
      if (el) el.style.display = "none";
    }
  };
  setContact("phoneDisplay", params.get("phone"));
  setContact("emailDisplay", params.get("email"));
  setContact("websiteDisplay", params.get("portfolio"));
  setContact("linkedinDisplay", params.get("linkedin"));
  setContact("githubDisplay", params.get("github"));

  // About (keep newlines)
  if (params.get('summary')) {
    // preserve newlines from the input -> show as new lines
    const summaryText = params.get('summary');
    // we already set CSS white-space: pre-line; but to be safe use innerText so newlines preserved
    const aboutEl = document.getElementById('summaryDisplay');
    aboutEl.textContent = summaryText;
  } else {
    document.getElementById('aboutSection').style.display = "none";
  }

  // Education
  if (params.get('education')) {
    document.getElementById('educationDisplay').innerHTML = makePairs(params.get('education'));
  } else {
    document.getElementById('educationSection').style.display = "none";
  }

  // Skills
  if (params.get('skills')) {
    document.getElementById('skillsDisplay').innerHTML = makeList(params.get('skills'));
  } else {
    document.getElementById('skillsSection').style.display = "none";
  }

  // Languages
  if (params.get('languages')) {
    document.getElementById('languagesDisplay').innerHTML = makeList(params.get('languages'));
  } else {
    document.getElementById('languagesSection').style.display = "none";
  }

  // Projects
  if (params.get('projects')) {
    document.getElementById('projectsDisplay').innerHTML = makePairs(params.get('projects'));
  } else {
    document.getElementById('projectsSection').style.display = "none";
  }

  // Certifications
  if (params.get('certifications')) {
    document.getElementById('certificationsDisplay').innerHTML = makeList(params.get('certifications'));
  } else {
    document.getElementById('certificationsSection').style.display = "none";
  }

  // Achievements
  if (params.get('achievements')) {
    document.getElementById('achievementsDisplay').innerHTML = makeList(params.get('achievements'));
  } else {
    document.getElementById('achievementsSection').style.display = "none";
  }

  // Interests
  if (params.get('interests')) {
    document.getElementById('interestsDisplay').innerHTML = makeList(params.get('interests'));
  } else {
    document.getElementById('interestsSection').style.display = "none";
  }
}

window.onload = populateResume;

function downloadPDF() {
  const params = new URLSearchParams(window.location.search);
  const pdfSize = params.get('pdfSize') || 'a4';

  const element = document.querySelector('.resume-container');
  if (!element) {
    alert("Resume content not found!");
    return;
  }

  const opt = {
    margin: 0,
    filename: 'resume.pdf',
    image: { type: 'jpeg', quality: 1 },
    html2canvas: { scale: 2, scrollX: 0, scrollY: 0 },
    jsPDF: { unit: 'pt', format: pdfSize, orientation: 'portrait' }
  };

  html2pdf().set(opt).from(element).save();
}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</body>
</html>
